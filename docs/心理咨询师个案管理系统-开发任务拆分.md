# 心理咨询师个案管理系统（个人版）开发任务拆分（Backlog / TODO）

> 基于《心理咨询师个案管理系统 PRD（个人版｜本地部署｜可打包 App）》整理。
> 目标：以 V1 核心可用上线，支持本地部署、离线优先、可打包 App。

## 1. 迭代与里程碑

## 1.1 V1（核心可用）

- 周日历（创建/拖拽改期/跨周/重复预约）
- 个案管理（列表 + 详情 + 指标）
- 个案工作文件夹（咨询记录、督导记录、测评资料）
- 预约完成自动生成咨询记录 Markdown
- ICS 订阅服务（localhost + 局域网可选）
- 全量导出 zip（db + files + manifest）

## 1.2 V1.1（增强）

- 文件名搜索 + Markdown 内容全文搜索（FTS）
- 导出加密（可选密码）

## 1.3 V1.2（恢复能力）

- 导入 zip（版本兼容 + 冲突策略）

---

## 2. 模块任务清单（按优先级）

> 估时单位：
> - XS：0.5 天内
> - S：1 天
> - M：2-3 天
> - L：4-5 天

## A. 工程基础与脚手架（P0）

- [ ] A1 初始化项目骨架（Vue3 + Vite + TS + Naive UI + Router + Pinia）（S）
- [ ] A2 建立目录规范（`db/`、`services/`、`features/`、`components/`）（XS）
- [ ] A3 建立统一时间工具（epoch ms ↔ 本地时区格式）（XS）
- [ ] A4 统一错误码与用户提示策略（XS）
- [ ] A5 基础设置页框架（后续挂 ICS/模板/导出）（XS）

## B. 数据层（SQLite + ORM）（P0）

- [ ] B1 按 PRD 建表：clients/appointments/recurring_series/recurring_exceptions/files（S）
- [ ] B2 建索引与迁移脚本（S）
- [ ] B3 种子数据与开发环境初始化（XS）
- [ ] B4 Repository 层（按实体 CRUD + 复用查询）（M）
- [ ] B5 数据完整性校验（status/category/rrule 合法性）（S）

## C. 个案管理（P0）

- [ ] C1 个案列表页字段展示（状态、标签、总次数、最近一次、下一次）（M）
- [ ] C2 搜索/筛选/排序（姓名、标签、状态、下次预约等）（S）
- [ ] C3 个案新增/编辑/状态流转（S）
- [ ] C4 个案详情指标区实时计算（completedCount、hours、last、next）（S）

## D. 周日历与预约（P0）

- [ ] D1 FullCalendar 周视图集成（时间刻度、默认周起始配置）（M）
- [ ] D2 创建预约（默认 50 分钟、非整点支持、关联个案）（S）
- [ ] D3 拖拽改期与时长调整（含持久化）（M）
- [ ] D4 跨周拖拽体验（自动翻周/边缘切换）（S）
- [ ] D5 预约状态切换 Scheduled/Completed/Canceled（S）
- [ ] D6 重复预约 weekly（rrule + 结束条件：无限/截止/N 次）（M）
- [ ] D7 “仅本次/整个系列”修改与 exceptions 持久化（L）

## E. 预约完成自动生成咨询记录（P0）

- [ ] E1 事件触发器：状态 Scheduled→Completed（XS）
- [ ] E2 文件名与路径生成规则（`YYYY-MM-DD HH-mm.md`）（XS）
- [ ] E3 Markdown 模板写入与可配置模板读取（S）
- [ ] E4 files 表登记（SessionNote + related_appointment_id）（XS）
- [ ] E5 幂等控制（同预约只创建一次）（XS）

## F. 工作文件夹（P0）

- [ ] F1 三大逻辑目录树（咨询记录/督导记录/测评资料）（S）
- [ ] F2 Markdown 编辑器（编辑/预览/保存）（M）
- [ ] F3 督导记录手动创建 md（XS）
- [ ] F4 测评资料上传/下载/重命名/删除（M）
- [ ] F5 删除二次确认与回收保护（S）

## G. ICS 订阅服务（P0）

- [ ] G1 生成 `calendar.ics`（DTSTART/DTEND/RRULE/EXDATE）（M）
- [ ] G2 启动本地 HTTP 服务（默认 127.0.0.1）（S）
- [ ] G3 局域网开关（0.0.0.0）+ 安全提示（XS）
- [ ] G4 地址展示与一键复制（localhost + 局域网 IP）（XS）
- [ ] G5 预约变更后的 ICS 实时刷新（XS）

## H. 导出（P0）

- [ ] H1 全量打包 zip：db + files + manifest（M）
- [ ] H2 manifest 版本与校验字段（XS）
- [ ] H3 导出完成提示与落盘路径展示（XS）

## I. 统计页（P1，建议）

- [ ] I1 今日/本周/本月完成节数与小时（S）
- [ ] I2 图表展示（可选）（S）

## J. 搜索增强（P1）

- [ ] J1 文件名搜索（XS）
- [ ] J2 Markdown 全文搜索（SQLite FTS）（M）

## K. App 打包准备（P1）

- [ ] K1 Capacitor 集成（iOS/Android）（M）
- [ ] K2 文件系统适配（沙盒目录映射）（M）
- [ ] K3 移动端路由与手势适配（S）

---

## 3. 关键验收任务（DoD）

## 3.1 日历 DoD

- [ ] 周视图可见所有预约（含重复实例）
- [ ] 13:30 等非整点预约可创建
- [ ] 拖拽跨周后数据不丢失
- [ ] 重复预约可单次例外/取消

## 3.2 个案 DoD

- [ ] 列表指标计算准确
- [ ] 详情页可编辑状态与标签
- [ ] 文件树操作完整可用

## 3.3 自动记录 DoD

- [ ] 完成预约后自动生成 md
- [ ] 文件名带时间、路径正确
- [ ] 重复点击完成不产生重复记录

## 3.4 ICS DoD

- [ ] 浏览器访问 URL 可下载/查看 .ics
- [ ] 改期与取消后 ICS 反映最新状态

## 3.5 导出 DoD

- [ ] zip 解压后结构清晰、文件完整
- [ ] manifest 包含时间、版本、校验摘要

---

## 4. 风险与预案

- **重复规则复杂度**：优先支持 weekly；月规则延后。
- **跨端时区偏差**：统一以 epoch ms 存储，显示层本地化。
- **移动端 ICS 兼容差异**：设置页提供“兼容性提示 + 局域网建议”。
- **文件误删风险**：关键删除动作加入二次确认。

---

## 5. 建议执行顺序（两周冲刺示例）

- **Sprint 1**：A + B + C + D（单次预约）+ E
- **Sprint 2**：D（重复+例外）+ F + G + H + 验收修复

